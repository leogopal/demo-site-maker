!function(d){"use strict";d.fn.serializeObject=function(){var e={},t=this.serializeArray();return d.each(t,function(){e[this.name]?(e[this.name].push||(e[this.name]=[e[this.name]]),e[this.name].push(this.value||"")):e[this.name]=this.value||""}),e},d.fn.mpDemoImageUpload=function(){return this.each(function(e,t){var a,i=d(this).closest("td");d(t).bind("click",function(e){e.preventDefault(),a||(a=wp.media.frames.file_frame=wp.media({title:d(this).data("uploader_title"),button:{text:d(this).data("uploader_button_text")},library:{type:"image"},multiple:!1})).on("select",function(){var e=a.state().get("selection").first().toJSON(),t=d(i.find(".upload_image_preview"));e=e.url,i.find(".mp_logo_url").val(e),t.show(),t.find("img").attr("src",e)}),a.open()})})},d.fn.mpDemoTabNav=function(){return this.each(function(e,t){d(t).on("click",function(e){e.preventDefault(),e.stopPropagation();var t=d(e.target),a=d(t).attr("href");d(".mp-demo-nav-tabs a").removeClass("nav-tab-active"),d(t).addClass("nav-tab-active"),d("div[id^='mp-demo-nav-tab-']").css("display","none"),d(a).fadeIn()})})};function c(e,t,a){e.action="route_url",d.ajax({url:MP_Demo_Ajax.url,type:"POST",data:e,success:function(e){t(e)},error:function(e,t){a(e)}})}function l(e){for(var t in e)d(e[t]).val("");d("#mp-source-select-items .upload_image_preview").hide()}function r(){var i={};window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(e,t,a){i[t]=a});return i}function s(){var o=d("#mp_add_table_item"),e=d("#mp_cancel_table_editing"),r={link_id:d("#select-link_id"),text:d("#select-text"),link:d("#select-link"),btn_text:d("#select-btn_text"),btn_url:d("#select-btn_url"),btn_class:d("#select-btn_class"),img:d("#select-img")},s=d("#mp-source-select-items").find("tbody");d.fn.sortable&&s.sortable({items:"tr",cursor:"move",opacity:.95}),o.click(function(){var e=function(e){var t={};for(var a in e)t[a]=e[a].val();return l(e),t}(r),t=d(this).parent().find(".spinner"),a=d(this).attr("data-action");if(d(t).addClass("is-active"),"edit"===a){var i=d(this).attr("data-id");!function(e,t,a){var i=t.link_id,n=d("#mp-source-select-items"),o=n.find("tr[data-id='"+a+"']");for(var r in e){var s=n.find("input[name='settings[select]["+a+"]["+r+"]']");s.val(t[r]),s.attr("name","settings[select]["+i+"]["+r+"]"),"img"===r?o.find("td.select-"+r+" img").attr("src",t[r]):o.find("td.select-"+r).text(t[r])}o.find(".delete-event-button").attr("data-id",i),o.find(".edit-event-button").attr("data-id",i),o.attr("data-id",i)}(r,e,i),o.val(MP_Demo_Ajax.add_text),o.attr("data-action","add"),o.attr("data-id",-1),d(t).removeClass("is-active")}else{var n={mp_demo_action:"add_row",controller:"toolbar",data:e,security:MP_Demo_Ajax.security};c(n,function(e){d(".mp-demo-no-rows-message").hide(),s.append(e.data),d(t).removeClass("is-active"),d("tr",s).removeClass("active")},function(e){console.log("Error ",e),d(t).removeClass("is-active"),d("tr",s).removeClass("active")})}}),e.click(function(){var e=d(this).parent().find(".spinner");l(r),d("tr",s).removeClass("active"),o.attr("data-action","add"),o.attr("data-id",-1),o.val(MP_Demo_Ajax.add_text),d(e).removeClass("is-active")}),s.delegate(".edit-event-button","click",function(e){var t=d(this).attr("data-id"),a=d(this).parent().find(".view-event-button"),i=function(e,t){var a={};for(var i in e)a[i]=d("input[name='settings[select]["+t+"]["+i+"]']").val();return l(e),a}(r,t);return d("tr",s).removeClass("active"),d('tr[data-id="'+t+'"]',s).addClass("active"),function(e,t){for(var a in e)d(e[a]).val(t[a])}(r,i),o.val(MP_Demo_Ajax.update_text),o.attr("data-action","edit"),o.attr("data-id",t),a.remove(),e.preventDefault(),!1}),s.delegate(".delete-event-button","click",function(e){var t=d(this).attr("data-id"),a=s.find("tr[data-id='"+t+"']");return a.after("<tr></tr>").hide(),a.empty(),d("tr",s).removeClass("active"),e.preventDefault(),!1})}function m(e,t){1==t?(d('input[name="settings[expiration_duration]"]',e).attr("disabled","disabled"),d('select[name="settings[expiration_measure]"]',e).attr("disabled","disabled")):(d('input[name="settings[expiration_duration]"]',e).removeAttr("disabled"),d('select[name="settings[expiration_measure]"]',e).removeAttr("disabled"))}d(document).ready(function(){var e,t,i,a,n,o;"toolbar"===r().tab&&(d(".mp-demo-colorpicker").wpColorPicker({defaultColor:!1}),s()),d(".mp-demo-nav-tabs a").mpDemoTabNav(),d("#mp-demo-test-email").click(function(){if(""!=d('input[name="test-email-receiver"]').val()){var e=d(".mp-admin-settings-email-form"),t=d(".mp-message",e),a=d(".spinner",e),i=e.serializeObject(),n={};n.security=MP_Demo_Ajax.security,n.mp_demo_action="send_test_email",n.controller="mail",n.mp_demo_url=window.location.href,n.mp_subtab=r().subtab,n.mp_subtab="undefined"!==n.mp_subtab?n.mp_subtab:"to-customer",a.addClass("is-active"),delete(i=d.extend(!0,i,n)).mp_demo_save,delete i.action,c(i,function(e){e&&(!0===e.success?(d(".mp-demo-success",t).fadeIn(),setTimeout(function(){d(".mp-demo-success",t).fadeOut()},5e3)):(d(".mp-demo-fail",t).fadeIn(),"undefined"!==e.errors&&d(".mp-demo-fail",t).find(".mp-errors").text(e.errors),setTimeout(function(){d(".mp-demo-fail",t).fadeOut()},5e3)),t.fadeIn()),a.removeClass("is-active")},function(e){console.log("Error ",e),a.removeClass("is-active")})}}),jQuery(".upload_image_button").mpDemoImageUpload(),d(".mp-admin-restrict").delegate(".mp-demo-parent","change",function(){var e=d(this).closest(".mp-parent-div").find('input[type="checkbox"]');this.checked?e.attr("checked","checked"):e.removeAttr("checked")}),e=d(".mp-demo-lifetime-wrap"),t=d('input[name="settings[is_lifetime]"]:checked',e).val(),m(e,t),d('input[name="settings[is_lifetime]"]',e).on("click",function(){m(e,d(this).val())}),function(){if("function"==typeof d().datepicker){var e=new Date(2e3,9,25);d("#mp-demo-datepicker-start").datepicker({minDate:e,dateFormat:"yy-mm-dd",onSelect:function(e,t){0}}),d("#mp-demo-datepicker-end").datepicker({dateFormat:"yy-mm-dd",beforeShowDay:function(e){var t=d.datepicker.formatDate("yy-mm-dd",e);return[d("#mp-demo-datepicker-start").val()<=t]}})}}(),i=d("#mp-demo-export-sandbox"),a=d("#mp-demo-add-replacement"),n=d("#mp-demo-export-info-wrap"),o=d("#mp-replacements-table").find("tbody"),d.fn.sortable&&o.sortable({items:"tr",cursor:"move",opacity:.95}),a.click(function(){var t=d(this).parent().find(".spinner");(t=d(t)).addClass("is-active");var e={mp_demo_action:"add_row",controller:"sandbox",security:MP_Demo_Ajax.security};c(e,function(e){d(".mp-demo-no-rows-message").hide(),o.append(e.data),t.removeClass("is-active"),d("tr",o).removeClass("active")},function(e){console.log("Error ",e),t.removeClass("is-active"),d("tr",o).removeClass("active")})}),o.delegate(".mp-demo-symbol-delete","click",function(e){return d(this).parent().parent().empty(),!1}),d("#mp-demo-export-info-wrap").delegate("#mp-demo-remove-export-files","click",function(e){e.preventDefault();var t=d(this).parent().find(".spinner"),a={};a.security=MP_Demo_Ajax.security,a.controller="sandbox",a.mp_demo_action="remove_export",a.source_path=d(this).attr("data-export"),(t=d(t)).addClass("is-active"),c(a,function(e){n.append(e.data.html),t.removeClass("is-active")},function(e){console.log("Error ",e),t.removeClass("is-active")})}),d(':input[type!="submit"]',i.get(0)).live("change",function(e){0==d('input[type="checkbox"]:checked',i).length?i.find(':input[type="submit"]').attr("disabled","disabled"):i.find(':input[type="submit"]').removeAttr("disabled")}),i.submit(function(e){e.preventDefault();var t=d(this).serializeObject(),a=d(".spinner",".submit");return a.addClass("is-active"),t.security=MP_Demo_Ajax.security,t.controller="sandbox",d("input",i).attr("disabled",!0),t.mp_demo_action="export_tables",c(t,function(e){n.append(e.data.html),t.mp_demo_action="apply_replacements",t.sql_file=e.data.sql_file,t.blog_export_folder=e.data.blog_export_folder,t.tables_count=e.data.tables_count,c(t,function(e){n.append(e.data.html),t.mp_demo_action="export_uploads",c(t,function(e){n.append(e.data.html),t.mp_demo_action="create_zip",c(t,function(e){n.append(e.data.html),a.removeClass("is-active")},function(e){console.log("Error ",e),a.removeClass("is-active")})},function(e){console.log("Error ",e),a.removeClass("is-active")})},function(e){console.log("Error ",e),a.removeClass("is-active")})},function(e){console.log("Error ",e),a.removeClass("is-active")}),!1})})}(jQuery);